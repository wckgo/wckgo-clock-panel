{"version":3,"sources":["../src/clock_ctrl.js"],"names":["PanelCtrl","moment","_","panelDefaults","mode","clockType","offsetFromUtc","offsetFromUtcMinutes","bgColor","countdownSettings","endCountdownTime","seconds","milliseconds","add","toDate","endText","dateSettings","showDate","dateFormat","fontSize","fontWeight","timeSettings","customFormat","ClockCtrl","$scope","$injector","defaultsDeep","panel","Date","events","on","onInitEditMode","bind","onPanelTeardown","render","updateClock","addEditorTab","$timeout","cancel","nextTickPromise","renderTime","renderCountdown","now","offsetInMinutes","parseInt","utcOffset","date","format","time","getTimeFormat","timeLeft","duration","diff","formattedTimeLeft","asSeconds","previous","years","months","days","hours","minutes","scope","elem","$panelContainer","find","css","templateUrl"],"mappings":"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","file":"clock_ctrl.js","sourcesContent":["import {PanelCtrl} from 'app/plugins/sdk';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport './css/clock-panel.css!';\r\n\r\nconst panelDefaults = {\r\n  mode: 'time',\r\n  clockType: '24 hour',\r\n  offsetFromUtc: null,\r\n  offsetFromUtcMinutes: null,\r\n  bgColor: null,\r\n  countdownSettings: {\r\n    endCountdownTime: moment().seconds(0).milliseconds(0).add(1, 'day').toDate(),\r\n    endText: '00:00:00'\r\n  },\r\n  dateSettings: {\r\n    showDate: false,\r\n    dateFormat: 'YYYY-MM-DD',\r\n    fontSize: '20px',\r\n    fontWeight: 'normal'\r\n  },\r\n  timeSettings: {\r\n    customFormat: 'HH:mm:ss',\r\n    fontSize: '60px',\r\n    fontWeight: 'normal'\r\n  }\r\n};\r\n\r\nexport class ClockCtrl extends PanelCtrl {\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n\r\n    if (!(this.panel.countdownSettings.endCountdownTime instanceof Date)) {\r\n      this.panel.countdownSettings.endCountdownTime = moment(this.panel.countdownSettings.endCountdownTime).toDate();\r\n    }\r\n\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\r\n    this.updateClock();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/plugins/grafana-clock-panel/editor.html', 2);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n    this.$timeout.cancel(this.nextTickPromise);\r\n  }\r\n\r\n  updateClock() {\r\n    if (this.panel.mode === 'time') {\r\n      this.renderTime();\r\n    } else {\r\n      this.renderCountdown();\r\n    }\r\n\r\n    this.nextTickPromise = this.$timeout(this.updateClock.bind(this), 1000);\r\n  }\r\n\r\n  renderTime() {\r\n    let now;\r\n\r\n    if (this.panel.offsetFromUtc && this.panel.offsetFromUtcMinutes) {\r\n      const offsetInMinutes = (parseInt(this.panel.offsetFromUtc, 10) * 60) + parseInt(this.panel.offsetFromUtcMinutes, 10);\r\n      now = moment().utcOffset(offsetInMinutes);\r\n    } else if (this.panel.offsetFromUtc && !this.panel.offsetFromUtcMinutes) {\r\n      now = moment().utcOffset(parseInt(this.panel.offsetFromUtc, 10));\r\n    } else {\r\n      now = moment();\r\n    }\r\n\r\n    if (this.panel.dateSettings.showDate) {\r\n      this.date = now.format(this.panel.dateSettings.dateFormat);\r\n    }\r\n\r\n    this.time = now.format(this.getTimeFormat());\r\n  }\r\n\r\n  getTimeFormat() {\r\n    if (this.panel.clockType === '24 hour') {\r\n      return 'HH:mm:ss';\r\n    }\r\n\r\n    if (this.panel.clockType === '12 hour') {\r\n      return 'h:mm:ss A';\r\n    }\r\n\r\n    return this.panel.timeSettings.customFormat;\r\n  }\r\n\r\n  renderCountdown() {\r\n    if (!this.panel.countdownSettings.endCountdownTime) {\r\n      this.time = this.panel.countdownSettings.endText;\r\n    }\r\n\r\n    const now = moment();\r\n    const timeLeft = moment.duration(moment(this.panel.countdownSettings.endCountdownTime).diff(now));\r\n    let formattedTimeLeft = '';\r\n\r\n    if (timeLeft.asSeconds() <= 0) {\r\n      this.time = this.panel.countdownSettings.endText;\r\n      return;\r\n    }\r\n\r\n    let previous = '';\r\n\r\n    if (timeLeft.years() > 0) {\r\n      formattedTimeLeft = timeLeft.years() === 1 ? '1 year, ' : timeLeft.years() + ' years, ';\r\n      previous = 'years';\r\n    }\r\n    if (timeLeft.months() > 0 || previous === 'years') {\r\n      formattedTimeLeft += timeLeft.months() === 1 ? '1 month, ' : timeLeft.months() + ' months, ';\r\n      previous = 'month';\r\n    }\r\n    if (timeLeft.days() > 0 || previous === 'months') {\r\n      formattedTimeLeft += timeLeft.days() === 1 ? '1 day, ' : timeLeft.days() + ' days, ';\r\n      previous = 'days';\r\n    }\r\n    if (timeLeft.hours() > 0 || previous === 'days') {\r\n      formattedTimeLeft += timeLeft.hours() === 1 ? '1 hour, ' : timeLeft.hours() + ' hours, ';\r\n      previous = 'hours';\r\n    }\r\n\r\n    if (timeLeft.minutes() > 0 || previous === 'hours') {\r\n      formattedTimeLeft += timeLeft.minutes() === 1 ? '1 minute, ' : timeLeft.minutes() + ' minutes, ';\r\n    }\r\n\r\n    formattedTimeLeft += timeLeft.seconds() === 1 ? '1 second ' : timeLeft.seconds() + ' seconds';\r\n    this.time = formattedTimeLeft;\r\n  }\r\n\r\n  link(scope, elem) {\r\n    this.events.on('render', () => {\r\n      const $panelContainer = elem.find('.panel-container');\r\n\r\n      if (this.panel.bgColor) {\r\n        $panelContainer.css('background-color', this.panel.bgColor);\r\n      } else {\r\n        $panelContainer.css('background-color', '');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nClockCtrl.templateUrl = 'module.html';\r\n"]}